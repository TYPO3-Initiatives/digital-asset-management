/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","moment","bootstrap"],function(e,t,a,n){"use strict";var r=function(){function e(){}return e.init=function(){var t=e;console.log(top.TYPO3.lang["localize.wizard.header"]),console.log(top.TYPO3.lang["dam.labels.filesize"]),console.log("DigitalAssetManagement.init"),t.request("getContent",""),a(".digital-asset-management").on("click",".folder-action",function(){var e=a(this).data("method"),n=a(this).data("parameter");console.log("method: "+e+", par: "+n),t.request(e,n)})},e.renderError=function(e){a(".errorlog").html(e.responseText)},e.renderContent=function(t){var r=e;if(t&&t.request&&a(".errorlog").html(t.request+t.response),t.getContent&&(t.getContent.files||t.getContent.folder)){for(var l="",i=0;i<t.getContent.folders.length;i++){var o=t.getContent.folders[i];o.mimetype="folder",l+=r.replaceTemplateVars(r.folderPartial,o)}a(".folders").html(l),l="";for(i=0;i<t.getContent.files.length;i++){var s=t.getContent.files[i];s.mimetype=s.mimetype.replace("/"," "),s.modification_date_formated=n(s.modification_date).format(top.TYPO3.settings.DateTimePicker.DateFormat[1]||"YYYY-MM-DD"),l+=r.replaceTemplateVars(r.filePartial,s)}a(".files").html(l)}},e.renderBreadcrumb=function(t){var n="",r=e;if(console.log("renderBreadCrumb"),console.log(t),t.getContent&&t.getContent.breadcrumbs){for(var l=0;l<t.getContent.breadcrumbs.length;l++){var i=t.getContent.breadcrumbs[l];"home"===i.type?i.label=TYPO3.lang["dam.labels.files"]:(i.label=i.name,n+="&nbsp;&gt;&nbsp;"),n+=r.replaceTemplateVars(r.breadcrumbPartial,i)}n?a(".breadcrumb").html(n).removeClass("empty"):a(".breadcrumb").html("").addClass("empty"),t.getContent.files.length?a(".files").removeClass("empty"):a(".files").addClass("empty"),t.getContent.folders.length?a(".folders").removeClass("empty"):a(".folders").addClass("empty")}},e.renderBreadcrumbOld=function(t){var n,r,l="",i="",o=[],s=e;if(console.log("renderBreadCrumb"),console.log(t),t.getContent){t.getContent.folders.length?((o=(r=t.getContent.folders[0]).identifier.split("/")).pop(),o.pop()):t.getContent.files.length&&(o=(r=t.getContent.files[0]).identifier.split("/")).pop(),console.log(o);for(var d=0;d<o.length;d++){var m=o[d];0===d?"storage"===r.type?(i=r.storage+":",n=r.storage_name||TYPO3.lang["dam.label.files"]):(i=r.uid+":",n=r.name||TYPO3.lang["dam.label.files"]):(i+="/"+m,n=m,l+="&nbsp;&gt;&nbsp;"),console.log("render breadcrumb identifier: "+r.identifier+", path: "+i+", part: "+m),l+=s.replaceTemplateVars(s.breadcrumbPartial,{pathsegment:i,part:m,label:n})}l?a(".breadcrumb").html(l).removeClass("empty"):a(".breadcrumb").html("").addClass("empty"),t.getContent.files.length?a(".files").removeClass("empty"):a(".files").addClass("empty"),t.getContent.folders.length?a(".folders").removeClass("empty"):a(".folders").addClass("empty")}},e.loadThumbs=function(){a(".card").each(function(e,t){var n=a(this).find(".thumbnail img"),r=n.attr("data-src");r&&(n.attr("src",r),a(this).find(".icon").addClass("small"))})},e.request=function(t,n){var r=e,l={};l[t]=n,a.getJSON(TYPO3.settings.ajaxUrls.dam_request,l).done(function(e){switch(t){case"getContent":r.renderBreadcrumb(e),r.renderContent(e),r.loadThumbs();break;default:top.TYPO3.Notification.warning("Request failed","Unknown method: "+t)}}).fail(function(e){console.log("DigitalAssetManagement request promise fail "+JSON.stringify(e)),top.TYPO3.Notification.warning("Request failed","Content can not be displayed. "+e.readyState),r.renderError(e)})},e.replaceTemplateVars=function(e,t){return e.replace(/{([:a-zA-Z_\.-]*)}/g,function(e,a){return 0===a.indexOf("lll:")?TYPO3.lang[a.replace(/lll:/,"")]||a:t.hasOwnProperty(a)?t[a]:"###missing prop:"+a+"#"})},e.folderPartial='    <div class="card folder-action d-inline-block {mimetype}" data-method="getContent" data-parameter="{identifier}" style="width: 180px;">\n   <div class="icon folder-icon {type}"></div>   <div class="card-body">\n   <h5 class="card-title">{name}</h5>\n    <p class="card-text">&nbsp;</p>\n    </div>\n  </div>\n',e.filePartial='<div class="card d-inline-block {mimetype}" style="width: 180px;">\n    <div class="thumbnail"><img src="/typo3conf/ext/digital_asset_management/Resources/Public/Images/empty.png" data-src="{thumburl}"></div>    <div class="icon icon-mimetypes-{mimetype}"></div>    <div class="card-body">\n    <h5 class="card-title">{name}</h5>\n    <p class="card-text">{lll:dam.labels.filesize}: {size} <br>{lll:dam.labels.modified}: {modification_date_formated}</p>\n    </div>\n  </div>\n',e.breadcrumbPartial='<span class="folder-action" data-method="getContent" data-parameter="{identifier}">{label}</span>',e}();return a(r.init),TYPO3.DigitalAssetManagementActions=r,r});
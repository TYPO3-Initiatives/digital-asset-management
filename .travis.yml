language: php

matrix:
  fast_finish: true
  include:
  - php: 7.2
    env: UNIT_TESTS=yes FUNCTIONAL_TESTS=yes PHP_LINT=yes PHP_CS_FIXER=yes
sudo: false

addons:
  apt:
    packages:
    - parallel

cache:
  directories:
  - $HOME/.composer/cache

before_script:
- phpenv config-rm xdebug.ini
- composer install --no-interaction 
- mkdir -p logs

script:
- |
  if [[ "$UNIT_TESTS" == "yes" ]]; then
    echo;
    echo "Running unit tests";
    composer test:php:unit
  fi
- |
  if [[ "FUNCTIONAL_TESTS" == "yes" ]]; then
    echo;
    echo "Running functional tests";
    composer test:php:functional
  fi
- |
  if [[ "$PHP_CS_FIXER" == "yes" ]]; then
    echo;
    echo "Running PHP CS Fixer";
    composer cgl
  fi
- |-
  if [[ "$PHP_LINT" == "yes" ]]; then
      echo;
      echo "Running php lint";
      find . -name \*.php -not -path "./vendor/*" | parallel --gnu php -d display_errors=stderr -l {} > /dev/null \;
  fi
